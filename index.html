<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Karty akcji</title>
    <style>
        :root {
            /* Zmienne dla trybu JASNEGO (domy≈õlny) */
            --bg-color: #e0e5ec;
            --text-color: #333;
            --card-bg-front: #ffffff;
            --card-bg-back: #ff6b6b; /* Kolor 'ty≈Çu' karty - a'la Monopoly Chance */
            --card-text: #2d3436;
            --bloom-color: rgba(255, 107, 107, 0.4);
            --shadow-light: #ffffff;
            --shadow-dark: #a3b1c6;
            --pattern-color: rgba(255,255,255,0.2);
            --btn-bg: #333;
            --btn-text: #fff;
        }

        [data-theme="dark"] {
            /* Zmienne dla trybu CIEMNEGO */
            --bg-color: #1a1a1a;
            --text-color: #f5f5f5;
            --card-bg-front: #2d2d2d;
            --card-bg-back: #d63031;
            --card-text: #ffeaa7;
            --bloom-color: rgba(214, 48, 49, 0.8);
            --shadow-light: #2b2b2b;
            --shadow-dark: #000000;
            --pattern-color: rgba(0,0,0,0.3);
            --btn-bg: #f5f5f5;
            --btn-text: #000;
        }

        * { box-sizing: border-box; transition: background-color 0.3s, color 0.3s; }

        body {
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            overflow: hidden;
        }

        /* --- Panel Sterowania --- */
        .controls {
            position: absolute;
            top: 20px;
            left: 20px;
            display: flex;
            gap: 10px;
            z-index: 100;
        }

        .theme-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 100;
            cursor: pointer;
            font-size: 24px;
            background: none;
            border: none;
            color: var(--text-color);
        }

        button, .file-upload-label {
            padding: 10px 20px;
            background-color: var(--btn-bg);
            color: var(--btn-text);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: transform 0.1s;
            font-size: 14px;
        }

        button:active, .file-upload-label:active {
            transform: scale(0.95);
        }

        input[type="file"] {
            display: none;
        }

        /* --- Scena Kart --- */
        .scene {
            width: 300px;
            height: 450px;
            perspective: 1000px; /* Kluczowe dla efektu 3D */
            position: relative;
        }

        /* Kontener karty (wrapper) */
.card {
    width: 100%;
    height: 100%;
    position: relative;
    transform-style: preserve-3d;
    transition: transform 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    cursor: pointer;
    will-change: transform; /* <--- DODAJ TO (poprawia p≈Çynno≈õƒá) */
}

        /* Stan: Karta odwr√≥cona */
        .card.flipped {
            transform: rotateY(180deg);
        }

        /* Stan: Karta wyrzucana (animacja wyj≈õcia) */
        .card.discarded {
            animation: flyOut 0.4s forwards ease;
        }

        @keyframes flyOut {
            100% { transform: translate(300px, -200px) scale(0.5); opacity: 0; }
        }

        @keyframes fix {
          35% { opacity: 1; }
          36% { opacity: 0; }
          100% { opacity: 0; }
        }
        
        .card.discarded .card__face--front {
            transform: rotateY(0deg);
            animation: fix 0.4s ease;
        }

        /* Prz√≥d i Ty≈Ç Karty */
        .card__face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden; /* Ukrywa ty≈Ç elementu przy obrocie */
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            text-align: center;
            box-shadow: 
                10px 10px 30px var(--shadow-dark), 
                -10px -10px 30px var(--shadow-light),
                0 0 20px var(--bloom-color); /* Efekt Bloom */
            font-size: 1.5rem;
            font-weight: bold;
        }

        /* WyglƒÖd TY≈ÅU (rewersu) - to co widzimy na poczƒÖtku */
        .card__face--back {
            background-color: var(--card-bg-back);
            color: white;
            transform: rotateY(0deg);
            /* Wzorek na tyle karty */
            background-image: repeating-linear-gradient(
                45deg,
                var(--pattern-color),
                var(--pattern-color) 10px,
                transparent 10px,
                transparent 20px
            );
            border: 4px solid white;
        }
        
        .card__face--back::after {
            content: "?";
            font-size: 80px;
            color: white;
            text-shadow: 0 0 10px rgba(0,0,0,0.5);
            background: rgba(0,0,0,0.1);
            width: 120px;
            height: 120px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* WyglƒÖd PRZODU (awersu) - tre≈õƒá */
        .card__face--front {
            background-color: var(--card-bg-front);
            color: var(--card-text);
            transform: rotateY(180deg);
            border: 2px solid var(--bloom-color);
        }

        /* Stos (wizualny efekt kart pod spodem) */
        .stack-placeholder {
            position: absolute;
            top: 5px;
            left: 5px;
            width: 300px;
            height: 450px;
            border-radius: 20px;
            background-color: var(--card-bg-back);
            z-index: -1;
            box-shadow: 2px 2px 10px rgba(0,0,0,0.3);
            opacity: 0.5;
        }
        .stack-placeholder:nth-child(2) { top: 10px; left: 10px; opacity: 0.3; z-index: -2; }

        /* Informacje o stanie */
        .status-bar {
            margin-top: 30px;
            font-size: 1.2rem;
            opacity: 0.7;
        }

    </style>
</head>
<body>

    <button class="theme-toggle" id="themeBtn" title="Prze≈ÇƒÖcz tryb">üåô</button>

    <div class="controls">
        <label for="fileInput" class="file-upload-label">üì• Importuj .txt</label>
        <input type="file" id="fileInput" accept=".txt">
        <button id="resetBtn">üîÑ Resetuj Stos</button>
    </div>

    <div class="scene">
        <div class="stack-placeholder"></div>
        <div class="stack-placeholder"></div>

        <div class="card" id="cardElement">
            <div class="card__face card__face--back"></div>
            <div class="card__face card__face--front">
                <span id="cardContent">Brak kart.<br>Zaimportuj plik .txt</span>
            </div>
        </div>
    </div>

    <div class="status-bar" id="statusBar">Karty: 0 / 0</div>

    <script>
        // --- ZMIENNE I ELEMENTY DOM ---
        const cardElement = document.getElementById('cardElement');
        const cardContent = document.getElementById('cardContent');
        const fileInput = document.getElementById('fileInput');
        const resetBtn = document.getElementById('resetBtn');
        const statusBar = document.getElementById('statusBar');
        const themeBtn = document.getElementById('themeBtn');

        let deck = []; // Tablica z tre≈õciƒÖ kart
        let currentIndex = 0; // Obecny indeks
        let isFlipped = false; // Czy karta jest odwr√≥cona
        let isAnimating = false; // Blokada klikania podczas animacji

        // --- FUNKCJE OBS≈ÅUGI DANYCH (LOCAL STORAGE) ---

        function saveData() {
            localStorage.setItem('monopoly_deck', JSON.stringify(deck));
            //localStorage.setItem('monopoly_index', currentIndex);
        }

        function loadData() {
            const savedDeck = localStorage.getItem('monopoly_deck');
            const savedIndex = 0// localStorage.getItem('monopoly_index');

            if (savedDeck) {
                deck = JSON.parse(savedDeck);
                currentIndex = parseInt(savedIndex) || 0;
                updateCardView();
            }
        }

        // Algorytm tasowania Fisher-Yates
        function shuffle(array) {
            new Audio('shuffle.mp3').play()
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // --- OBS≈ÅUGA PLIKU ---

        fileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (event) => {
                const text = event.target.result;
                // Dzielenie po nowych liniach i usuwanie pustych
                const lines = text.split(/\r?\n/).filter(line => line.trim() !== "");
                
                if (lines.length > 0) {
                    deck = shuffle(lines);
                    currentIndex = 0;
                    isFlipped = false;
                    
                    // Reset wizualny
                    cardElement.classList.remove('flipped', 'discarded');
                    
                    saveData();
                    updateCardView();
                    alert(`Zaimportowano i przetasowano ${deck.length} kart.`);
                } else {
                    alert("Plik jest pusty!");
                }
            };
            reader.readAsText(file, 'UTF-8');
            // Reset inputa, ≈ºeby mo≈ºna by≈Ço za≈Çadowaƒá ten sam plik ponownie
            fileInput.value = '';
        });

        // --- LOGIKA KARTY (KLIKANIE) ---

        function updateCardView() {
            // Aktualizacja licznika
            statusBar.innerText = deck.length > 0 
                ? `Karta: ${currentIndex + 1} / ${deck.length}` 
                : 'Brak kart';

            // Sprawdzenie czy koniec talii
            if (deck.length > 0 && currentIndex < deck.length) {
                cardContent.innerText = deck[currentIndex];
            } else if (deck.length > 0 && currentIndex >= deck.length) {
                cardContent.innerText = "Koniec talii!";
                cardElement.style.pointerEvents = 'none'; // Blokada klikania
            } else {
                cardContent.innerHTML = "Brak kart.<br>Zaimportuj plik .txt";
            }
        }

function nextCard() {
            // 1. Zwiƒôksz indeks
            currentIndex++;
            saveData();

            // 2. ZATRZYMAJ animacje na moment resetu (wa≈ºne!)
            // Ustawiamy na 'none', aby karta natychmiast wr√≥ci≈Ça na miejsce bez "przylatywania"
            cardElement.style.transition = 'none';
            cardElement.style.animation = 'none';
            
            // 3. Usu≈Ñ klasy stanu (karta wraca do pozycji startowej, zakrytej)
            cardElement.classList.remove('flipped', 'discarded');
            
            // 4. Wymu≈õ "Reflow" (przeglƒÖdarka musi przeliczyƒá style w tym momencie)
            // To trik, kt√≥ry oddziela usuniƒôcie klas od przywr√≥cenia animacji
            void cardElement.offsetWidth;

            // 5. PRZYWR√ìƒÜ ustawienia z CSS
            // Czy≈õcimy style inline (ustawiamy na pusty string), dziƒôki czemu
            // przeglƒÖdarka zn√≥w bierze warto≈õci z arkusza styl√≥w CSS.
            cardElement.style.transition = ''; 
            cardElement.style.animation = '';

            // 6. Aktualizuj tre≈õƒá nowej karty
            updateCardView();

            // Reset flag logicznych
            isFlipped = false;
            isAnimating = false;
        }

        cardElement.addEventListener('click', () => {
            if (isAnimating) return; // Zapobiega spamowaniu kliniƒôƒá
            if (deck.length === 0 || currentIndex >= deck.length) return;

                const randomNum = Math.floor(Math.random() * 4) + 1;
                new Audio(`${randomNum}.mp3`).play()

            if (!isFlipped) {
                // KROK 1: Odwr√≥ƒá (poka≈º tre≈õƒá)
                cardElement.classList.add('flipped');
                isFlipped = true;
            } else {
                // KROK 2: Wyrzuƒá i ≈Çaduj nastƒôpnƒÖ
                isAnimating = true;
                cardElement.classList.add('discarded');

                // Czekamy na koniec animacji 'flyOut' (0.6s)
// Czekamy na koniec animacji 'flyOut'
                setTimeout(() => {
                    nextCard();
                }, 450); // Zmiana z 600 na 650 dla pewno≈õci
            }
        });

        resetBtn.addEventListener('click', () => {
            if(confirm("Czy na pewno chcesz zresetowaƒá taliƒô i zaczƒÖƒá od poczƒÖtku?")) {
                deck = shuffle(deck); // Opcjonalnie: przetasuj ponownie przy resecie
                currentIndex = 0;
                isFlipped = false;
                cardElement.classList.remove('flipped', 'discarded');
                cardElement.style.pointerEvents = 'auto';
                saveData();
                updateCardView();
            }
        });

        // --- TRYB CIEMNY / JASNY ---

        // Sprawdzenie zapisanego motywu lub preferencji systemowych
        const savedTheme = localStorage.getItem('theme');
        const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;

        if (savedTheme === 'dark' || (!savedTheme && prefersDark)) {
            document.documentElement.setAttribute('data-theme', 'dark');
            themeBtn.innerText = '‚òÄÔ∏è';
        }

        themeBtn.addEventListener('click', () => {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            if (currentTheme === 'dark') {
                document.documentElement.setAttribute('data-theme', 'light');
                localStorage.setItem('theme', 'light');
                themeBtn.innerText = 'üåô';
            } else {
                document.documentElement.setAttribute('data-theme', 'dark');
                localStorage.setItem('theme', 'dark');
                themeBtn.innerText = '‚òÄÔ∏è';
            }
        });

        // --- START ---
        loadData();

    </script>
</body>
</html>