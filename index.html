<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Karty akcji</title>
    <style>
        :root {
            /* Zmienne dla trybu JASNEGO (domyÅ›lny) */
            --bg-color: #e0e5ec;
            --text-color: #333;
            --card-bg-front: #ffffff;
            --card-bg-back: #ff6b6b; /* Kolor 'tyÅ‚u' karty - a'la Monopoly Chance */
            --card-text: #2d3436;
            --bloom-color: rgba(255, 107, 107, 0.4);
            --shadow-light: #ffffff;
            --shadow-dark: #a3b1c6;
            --pattern-color: rgba(255,255,255,0.2);
            --btn-bg: #333;
            --btn-text: #fff;
        }

        [data-theme="dark"] {
            /* Zmienne dla trybu CIEMNEGO */
            --bg-color: #1a1a1a;
            --text-color: #f5f5f5;
            --card-bg-front: #2d2d2d;
            --card-bg-back: #d63031;
            --card-text: #ffeaa7;
            --bloom-color: rgba(214, 48, 49, 0.8);
            --shadow-light: #2b2b2b;
            --shadow-dark: #000000;
            --pattern-color: rgba(0,0,0,0.3);
            --btn-bg: #f5f5f5;
            --btn-text: #000;
        }

        * { box-sizing: border-box; transition: background-color 0.3s, color 0.3s; }

        body {
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            overflow: hidden;
        }

        /* --- Panel Sterowania --- */
        .controls {
            position: absolute;
            top: 20px;
            left: 20px;
            display: flex;
            gap: 10px;
            z-index: 100;
        }

        .theme-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 100;
            cursor: pointer;
            font-size: 24px;
            background: none;
            border: none;
            color: var(--text-color);
        }

        button, .file-upload-label {
            padding: 10px 20px;
            background-color: var(--btn-bg);
            color: var(--btn-text);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: transform 0.1s;
            font-size: 14px;
        }

        button:active, .file-upload-label:active {
            transform: scale(0.95);
        }

        input[type="file"] {
            display: none;
        }

        /* --- Scena Kart --- */
        .scene {
            width: 300px;
            height: 450px;
            perspective: 1000px; /* Kluczowe dla efektu 3D */
            position: relative;
        }

        /* Kontener karty (wrapper) */
.card {
    width: 100%;
    height: 100%;
    position: relative;
    transform-style: preserve-3d;
    transition: transform 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    cursor: pointer;
    will-change: transform; /* <--- DODAJ TO (poprawia pÅ‚ynnoÅ›Ä‡) */
}

        /* Stan: Karta odwrÃ³cona */
        .card.flipped {
            transform: rotateY(180deg);
        }

        /* Stan: Karta wyrzucana (animacja wyjÅ›cia) */
        .card.discarded {
            animation: flyOut 0.4s forwards ease;
        }

        @keyframes flyOut {
            100% { transform: translate(300px, -200px) scale(0.5); opacity: 0; }
        }

        @keyframes fix {
          35% { opacity: 1; }
          36% { opacity: 0; }
          100% { opacity: 0; }
        }
        
        .card.discarded .card__face--front {
            transform: rotateY(0deg);
            animation: fix 0.4s ease;
        }

        /* PrzÃ³d i TyÅ‚ Karty */
        .card__face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden; /* Ukrywa tyÅ‚ elementu przy obrocie */
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            text-align: center;
            box-shadow: 
                10px 10px 30px var(--shadow-dark), 
                -10px -10px 30px var(--shadow-light),
                0 0 20px var(--bloom-color); /* Efekt Bloom */
            font-size: 1.5rem;
            font-weight: bold;
        }

        /* WyglÄ…d TYÅU (rewersu) - to co widzimy na poczÄ…tku */
        .card__face--back {
            background-color: var(--card-bg-back);
            color: white;
            transform: rotateY(0deg);
            /* Wzorek na tyle karty */
            background-image: repeating-linear-gradient(
                45deg,
                var(--pattern-color),
                var(--pattern-color) 10px,
                transparent 10px,
                transparent 20px
            );
            border: 4px solid white;
        }
        
        .card__face--back::after {
            content: "?";
            font-size: 80px;
            color: white;
            text-shadow: 0 0 10px rgba(0,0,0,0.5);
            background: rgba(0,0,0,0.1);
            width: 120px;
            height: 120px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* WyglÄ…d PRZODU (awersu) - treÅ›Ä‡ */
        .card__face--front {
            background-color: var(--card-bg-front);
            color: var(--card-text);
            transform: rotateY(180deg);
            border: 2px solid var(--bloom-color);
        }

        /* Stos (wizualny efekt kart pod spodem) */
        .stack-placeholder {
            position: absolute;
            top: 5px;
            left: 5px;
            width: 300px;
            height: 450px;
            border-radius: 20px;
            background-color: var(--card-bg-back);
            z-index: -1;
            box-shadow: 2px 2px 10px rgba(0,0,0,0.3);
            opacity: 0.5;
        }
        .stack-placeholder:nth-child(2) { top: 10px; left: 10px; opacity: 0.3; z-index: -2; }

        /* Informacje o stanie */
        .status-bar {
            margin-top: 30px;
            font-size: 1.2rem;
            opacity: 0.7;
        }

    </style>
</head>
<body>

    <button class="theme-toggle" id="themeBtn" title="PrzeÅ‚Ä…cz tryb">ðŸŒ™</button>

    <div class="controls">
        <label for="fileInput" class="file-upload-label">ðŸ“¥ Importuj .txt</label>
        <input type="file" id="fileInput" accept=".txt">
        <button id="resetBtn">ðŸ”„ Resetuj Stos</button>
    </div>

    <div class="scene">
        <div class="stack-placeholder"></div>
        <div class="stack-placeholder"></div>

        <div class="card" id="cardElement">
            <div class="card__face card__face--back"></div>
            <div class="card__face card__face--front">
                <span id="cardContent">Brak kart.<br>Zaimportuj plik .txt</span>
            </div>
        </div>
    </div>

    <div class="status-bar" id="statusBar">Karty: 0 / 0</div>

    <script>
        // --- ZMIENNE I ELEMENTY DOM ---
        const cardElement = document.getElementById('cardElement');
        const cardContent = document.getElementById('cardContent');
        const fileInput = document.getElementById('fileInput');
        const resetBtn = document.getElementById('resetBtn');
        const statusBar = document.getElementById('statusBar');
        const themeBtn = document.getElementById('themeBtn');

        let deck = []; // Tablica z treÅ›ciÄ… kart
        let currentIndex = 0; // Obecny indeks
        let isFlipped = false; // Czy karta jest odwrÃ³cona
        let isAnimating = false; // Blokada klikania podczas animacji

        // --- FUNKCJE OBSÅUGI DANYCH (LOCAL STORAGE) ---

        function saveData() {
            localStorage.setItem('monopoly_deck', JSON.stringify(deck));
            //localStorage.setItem('monopoly_index', currentIndex);
        }

        function loadData() {
            const savedDeck = localStorage.getItem('monopoly_deck');
            const savedIndex = 0// localStorage.getItem('monopoly_index');

            if (savedDeck) {
                deck = JSON.parse(savedDeck);
                currentIndex = parseInt(savedIndex) || 0;
                updateCardView();
            }
        }

        // Algorytm tasowania Fisher-Yates
        function shuffle(array) {
            new Audio('shuffle.mp3').play()
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // --- OBSÅUGA PLIKU ---

        fileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (event) => {
                const text = event.target.result;
                // Dzielenie po nowych liniach i usuwanie pustych
                const lines = text.split(/\r?\n/).filter(line => line.trim() !== "");
                
                if (lines.length > 0) {
                    deck = shuffle(lines);
                    currentIndex = 0;
                    isFlipped = false;
                    
                    // Reset wizualny
                    cardElement.classList.remove('flipped', 'discarded');
                    
                    saveData();
                    updateCardView();
                    alert(`Zaimportowano i przetasowano ${deck.length} kart.`);
                } else {
                    alert("Plik jest pusty!");
                }
            };
            reader.readAsText(file, 'UTF-8');
            // Reset inputa, Å¼eby moÅ¼na byÅ‚o zaÅ‚adowaÄ‡ ten sam plik ponownie
            fileInput.value = '';
        });

        // --- LOGIKA KARTY (KLIKANIE) ---

        function updateCardView() {
            // Aktualizacja licznika
            statusBar.innerText = deck.length > 0 
                ? `Karta: ${currentIndex + 1} / ${deck.length}` 
                : 'Brak kart';

            // Sprawdzenie czy koniec talii
            if (deck.length > 0 && currentIndex < deck.length) {
                cardContent.innerText = deck[currentIndex];
            } else if (deck.length > 0 && currentIndex >= deck.length) {
                cardContent.innerText = "Koniec talii!";
                cardElement.style.pointerEvents = 'none'; // Blokada klikania
            } else {
                cardContent.innerHTML = "Brak kart.<br>Zaimportuj plik .txt";
            }
        }

function nextCard() {
            // 1. ZwiÄ™ksz indeks
            currentIndex++;
            saveData();

            // 2. ZATRZYMAJ animacje na moment resetu (waÅ¼ne!)
            // Ustawiamy na 'none', aby karta natychmiast wrÃ³ciÅ‚a na miejsce bez "przylatywania"
            cardElement.style.transition = 'none';
            cardElement.style.animation = 'none';
            
            // 3. UsuÅ„ klasy stanu (karta wraca do pozycji startowej, zakrytej)
            cardElement.classList.remove('flipped', 'discarded');
            
            // 4. WymuÅ› "Reflow" (przeglÄ…darka musi przeliczyÄ‡ style w tym momencie)
            // To trik, ktÃ³ry oddziela usuniÄ™cie klas od przywrÃ³cenia animacji
            void cardElement.offsetWidth;

            // 5. PRZYWRÃ“Ä† ustawienia z CSS
            // CzyÅ›cimy style inline (ustawiamy na pusty string), dziÄ™ki czemu
            // przeglÄ…darka znÃ³w bierze wartoÅ›ci z arkusza stylÃ³w CSS.
            cardElement.style.transition = ''; 
            cardElement.style.animation = '';

            // 6. Aktualizuj treÅ›Ä‡ nowej karty
            updateCardView();

            // Reset flag logicznych
            isFlipped = false;
            isAnimating = false;
        }

        cardElement.addEventListener('click', () => {
            if (isAnimating) return; // Zapobiega spamowaniu kliniÄ™Ä‡
            if (deck.length === 0 || currentIndex >= deck.length) return;

                const randomNum = Math.floor(Math.random() * 4) + 1;
                new Audio(`${randomNum}.mp3`).play()

            if (!isFlipped) {
                // KROK 1: OdwrÃ³Ä‡ (pokaÅ¼ treÅ›Ä‡)
                cardElement.classList.add('flipped');
                isFlipped = true;
            } else {
                // KROK 2: WyrzuÄ‡ i Å‚aduj nastÄ™pnÄ…
                isAnimating = true;
                cardElement.classList.add('discarded');

                // Czekamy na koniec animacji 'flyOut' (0.6s)
// Czekamy na koniec animacji 'flyOut'
                setTimeout(() => {
                    nextCard();
                }, 450); // Zmiana z 600 na 650 dla pewnoÅ›ci
            }
        });

        resetBtn.addEventListener('click', () => {
            if(confirm("Czy na pewno chcesz zresetowaÄ‡ taliÄ™ i zaczÄ…Ä‡ od poczÄ…tku?")) {
                deck = shuffle(deck); // Opcjonalnie: przetasuj ponownie przy resecie
                currentIndex = 0;
                isFlipped = false;
                cardElement.classList.remove('flipped', 'discarded');
                cardElement.style.pointerEvents = 'auto';
                saveData();
                updateCardView();
            }
        });

        // --- TRYB CIEMNY / JASNY ---

        // Sprawdzenie zapisanego motywu lub preferencji systemowych
        const savedTheme = localStorage.getItem('theme');
        const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;

        if (savedTheme === 'dark' || (!savedTheme && prefersDark)) {
            document.documentElement.setAttribute('data-theme', 'dark');
            themeBtn.innerText = 'â˜€ï¸';
        }

        themeBtn.addEventListener('click', () => {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            if (currentTheme === 'dark') {
                document.documentElement.setAttribute('data-theme', 'light');
                localStorage.setItem('theme', 'light');
                themeBtn.innerText = 'ðŸŒ™';
            } else {
                document.documentElement.setAttribute('data-theme', 'dark');
                localStorage.setItem('theme', 'dark');
                themeBtn.innerText = 'â˜€ï¸';
            }
        });

        // --- START ---
        //loadData();



        // 1. StaÅ‚a z adresem pliku tekstowego (lokalny lub URL)
const DEFAULT_DECK_URL = 'https://wojtaszero.github.io/gra/karty%20akcji.txt'; 

// 2. WspÃ³lna funkcja inicjujÄ…ca grÄ™ (Å¼eby nie powielaÄ‡ kodu)
function loadDeckFromText(text, sourceName = 'nieznane ÅºrÃ³dÅ‚o') {
    // Dzielenie po nowych liniach i usuwanie pustych
    const lines = text.split(/\r?\n/).filter(line => line.trim() !== "");

    if (lines.length > 0) {
        deck = shuffle(lines);
        currentIndex = 0;
        isFlipped = false;

        // Reset wizualny
        if (typeof cardElement !== 'undefined') {
            cardElement.classList.remove('flipped', 'discarded');
        }

        saveData();
        updateCardView(); // ZakÅ‚adam, Å¼e ta funkcja istnieje w Twoim kodzie
        
        console.log(`ZaÅ‚adowano ${deck.length} kart z: ${sourceName}`);
        // Opcjonalnie: alert tylko jeÅ›li to nie jest autostart, Å¼eby nie denerwowaÄ‡ usera
        if (sourceName === 'Plik uÅ¼ytkownika') {
             alert(`Zaimportowano i przetasowano ${deck.length} kart.`);
        }
    } else {
        console.warn("Pobrany tekst nie zawiera Å¼adnych linii/kart.");
        if (sourceName === 'Plik uÅ¼ytkownika') alert("Plik jest pusty!");
    }
}

// 4. NOWOÅšÄ†: Logika Autostartu (pobieranie z URL przy starcie)
document.addEventListener('DOMContentLoaded', () => {
    // Sprawdzamy, czy mamy juÅ¼ zapisany stan gry, Å¼eby nie nadpisywaÄ‡ postÄ™pu
    // JeÅ›li chcesz ZAWSZE resetowaÄ‡ grÄ™ przy odÅ›wieÅ¼eniu, usuÅ„ ten warunek if (localStorage...)
    if (localStorage.getItem('deck') && localStorage.getItem('deck') !== '[]') {
        console.log("PrzywrÃ³cono zapisanÄ… grÄ™, pomijam autostart z URL.");
        // Tutaj powinna byÄ‡ Twoja funkcja loadData() lub init(), ktÃ³ra przywraca stan
        return; 
    }

    // JeÅ›li nie ma zapisu, pobieramy z URL
    fetch(DEFAULT_DECK_URL)
        .then(response => {
            if (!response.ok) {
                throw new Error(`BÅ‚Ä…d HTTP: ${response.status}`);
            }
            return response.text();
        })
        .then(text => {
            loadDeckFromText(text, 'URL Autostart');
        })
        .catch(error => {
            console.error("Nie udaÅ‚o siÄ™ pobraÄ‡ domyÅ›lnej talii:", error);
        });
});

    </script>
</body>
</html>
